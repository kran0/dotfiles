#!/bin/sh

TEXT=$*
TEXTSELECT=(
 "$(sensors --no-adapter | sed -e 's/(.*//')"
 "$(echo 'This system is running since' ;uptime --since)"
 "$(echo 'This system is ' ;uptime --pretty)"
 "$(uname -a)"
 "$(echo 'I am '; whoami)"
 )
[ "$1" == "" ] && TEXT=${TEXTSELECT[RANDOM%${#TEXTSELECT[@]}]}

ACTION=( /cowsay/bin/cowsay /cowsay/bin/cowthink )
ACTION="${ACTION[RANDOM%${#ACTION[@]}]}"

MODE=( -b -d -g -p -s -t -w -y )
MODE="${MODE[RANDOM%${#MODE[@]}]}"

exec container-build-run\
 IMAGE_NAME="cowsay:latest"\
 CONTAINERFILE='FROM docker.io/library/alpine:edge AS prepare

RUN apk add git perl
RUN git clone https://github.com/tnalpgge/rank-amateur-cowsay.git /cowsay-repo
RUN mkdir -vp /cowsay\
 && cd /cowsay-repo\
 && ./install.sh /cowsay

RUN rm -rvf /cowsay/man

FROM docker.io/library/alpine:edge
RUN apk add --no-cache perl
COPY --from=prepare /cowsay /cowsay
CMD [ "/cowsay/bin/cowsay" ]
'\
 RUN_CONTEXT="-it --rm -e TERM=\"${TERM}\""\
 RUN_COMMAND="${ACTION} -W 77 ${MODE} \"${TEXT}\""
