#!/bin/sh

TEXT=$*
TEXTSELECT=(
 "$(sensors --no-adapter | sed -e 's/(.*//')"
 "$(echo 'This system is running since' ;uptime --since)"
 "$(echo 'This system is ' ;uptime --pretty)"
 "$(uname -a)"
 "$(echo 'I am '; whoami)"
 )
[ "$1" == "" ] && TEXT=${TEXTSELECT[RANDOM%${#TEXTSELECT[@]}]}

ACTION=( /cowsay/bin/cowsay /cowsay/bin/cowthink )
ACTION="${ACTION[RANDOM%${#ACTION[@]}]}"

MODE=( -b -d -g -p -s -t -w -y )
MODE="${MODE[RANDOM%${#MODE[@]}]}"

exec container-build-run - ${ACTION} -W 77 ${MODE} "${TEXT}" << Containerfile

# containerfile-build-run directives
# IMAGE_NAME=cowsay:latest
# START_ARGUMENTS=-i --rm -e TERM=${TERM}

FROM docker.io/library/alpine:edge AS base
RUN apk add --update --no-cache perl

FROM base AS prepare

RUN apk add git
RUN git clone https://github.com/tnalpgge/rank-amateur-cowsay.git /cowsay-repo
RUN mkdir -vp /cowsay\
 && cd /cowsay-repo\
 && ./install.sh /cowsay

RUN rm -rvf /cowsay/man

FROM base

COPY --from=prepare /cowsay /cowsay
CMD [ "/cowsay/bin/cowsay" ]
Containerfile
